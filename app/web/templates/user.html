{% extends "base.html" %}

{% block title %}{{ display_name }}MentraAI{% endblock %}

{% block head_css %}
  <link rel="stylesheet" href="/static/css/user.css">
{% endblock %}

{% block content %}
<div class="glass user-glass">

  <!-- Header -->
  <div class="u-header">
    <div class="u-left">
      <img src="{{ avatar_url }}" alt="" class="u-avatar">
      <div>
        <div class="u-name-row">
          <h1 class="u-name">{{ display_name }}</h1>
        </div>
        <div class="u-sub">Activity overview</div>
      </div>
    </div>

    <div class="u-stats">
      <div class="u-stat"><span class="k">Quizzes</span><span class="v">{{ stats.quizzes }}</span></div>
      <div class="u-sep"></div>
      <div class="u-stat"><span class="k">Accuracy</span><span class="v">{{ stats.accuracy_pct }}%</span></div>
      <div class="u-sep"></div>
      <div class="u-stat"><span class="k">Streak</span><span class="v">ðŸ”¥ {{ stats.streak_days }}d</span></div>
      <div class="u-sep"></div>
      <div class="u-stat">
        <span class="k">Best</span>
        <a class="v best-link" href="/?topic={{ stats.best_topic | urlencode }}" title="Open leaderboard filtered by {{ stats.best_topic }}">
          {{ stats.best_topic }}
        </a>
      </div>
    </div>
  </div>

  <hr class="user-divider">

  <!-- Heatmap -->
  <div class="hm-center">
    <div class="glass hm-card">

      <div class="hm-card-head">
        <div class="hm-key">
          <div class="title">Key</div>
          <div class="krow">
            <span><i class="sw lv0"></i>No</span>
            <span><i class="sw lv1"></i>1+</span>
            <span><i class="sw lv2"></i>2+</span>
            <span><i class="sw lv3"></i>3+</span>
            <span><i class="sw lv4"></i>7+</span>
          </div>
        </div>

        <div class="hm-rightHead">
          <div class="hm-yearInline" aria-label="Year selector">
            <a id="hmPrevYear" class="hm-yearBtn" href="#" aria-label="Previous year">â€¹</a>
            <div id="hmYearLabel" class="hm-year">â€”</div>
            <a id="hmNextYear" class="hm-yearBtn" href="#" aria-label="Next year">â€º</a>
          </div>

          <div class="hm-total">
            <div class="lbl">Total points this year</div>
            <div class="val" id="hmTotalYear">0</div>
          </div>
        </div>
      </div>

      <div id="hmNoData" class="muted hm-nodata d-none">
        No activity for this year.
      </div>

      <div class="hm-wrap d-none" id="hmWrap">
        <div class="hm-y" aria-hidden="true">
          <span></span>
          <span>Mon</span>
          <span></span>
          <span>Wed</span>
          <span></span>
          <span>Fri</span>
          <span></span>
        </div>

        <div class="hm-right">
          <div class="hm-months" id="hmMonths"></div>
          <div class="hm-grid" id="hmGrid" aria-label="Yearly activity heatmap"></div>
        </div>
      </div>

      <!-- Data for JS -->
      <div id="hmData"
           data-labels='{{ series_labels | tojson | safe }}'
           data-values='{{ series_values | tojson | safe }}'></div>

    </div>
  </div>

  <hr class="user-divider">

  <!-- Recent runs -->
  <div class="sec-head">
    <h2 class="sec-title">Recent runs</h2>
    <div class="sec-muted">Click a topic to filter the leaderboard</div>
  </div>

  <div class="mt-3">
    {% if runs %}
      <div class="table-responsive">
        <table class="table table-clean table-hover table-sm align-middle mb-0 u-runs-table">
          <thead>
            <tr>
              <th class="col-topic">Topic</th>
              <th class="col-score">Score</th>
              <th class="col-when">When</th>
            </tr>
          </thead>
          <tbody>
            {% for r in runs %}
              <tr>
                <td>
                  <a href="/?topic={{ r.topic | urlencode }}" class="topic-link">{{ r.topic }}</a>
                </td>
                <td class="score-strong">{{ r.score }}/{{ r.total }}</td>
                <td class="muted-small">{{ r.created_at }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="muted user-empty">No runs yet.</div>
    {% endif %}
  </div>

</div>
{% endblock %}

{% block body_js %}
  <script src="/static/js/user_heatmap.js"></script>
{% endblock %}
